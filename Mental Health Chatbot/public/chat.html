<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Tuliabot Chat</title>
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;700&display=swap" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" />
  <style>
    body {
      font-family: 'Nunito', sans-serif;
    }
    .chat-container {
      max-height: calc(100vh - 144px);
      overflow-y: auto;
    }
  </style>
</head>
<body class="bg-blue-50 flex flex-col min-h-screen">

  <!-- Header -->
  <header class="bg-white shadow p-4 flex justify-between items-center">
    <h1 class="text-lg font-bold text-blue-700">Tuliabot</h1>
    <div class="text-xs space-x-1">
      <button class="text-blue-500 font-medium">ğŸ‡°ğŸ‡ª Swahili</button>
      <span>|</span>
      <button class="text-gray-500">ğŸ‡¬ğŸ‡§ English</button>
    </div>
  </header>

  <!-- Chat Area -->
  <main class="chat-container px-4 py-2 flex flex-col gap-3" id="chat-area">
    <div class="bg-white text-gray-800 p-3 rounded-xl shadow w-fit max-w-[75%]">
      Hi there! ğŸ‘‹<br> How are you feeling today?
    </div>
  </main>

  <!-- Chat Input -->
  <footer class="bg-white px-4 py-3 flex gap-2 border-t">
    <input
      id="user-input"
      type="text"
      placeholder="Type your message..."
      class="flex-grow border border-gray-300 rounded-full px-4 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-400"
    />
    <button id="send-btn"
      class="bg-blue-600 text-white px-4 py-2 rounded-full text-sm hover:bg-blue-700">
      Send
    </button>
  </footer>

  <script>
    const chatContainer = document.getElementById('chat-area');

    function addMessage(content, isBot = false) {
      const bubble = document.createElement('div');
      bubble.className = `${isBot
        ? 'bg-white text-gray-800'
        : 'self-end bg-blue-600 text-white'} p-3 rounded-xl shadow max-w-[75%] w-fit`;
      bubble.innerText = content;
      chatContainer.appendChild(bubble);
      chatContainer.scrollTop = chatContainer.scrollHeight;
    }

    async function sendMessage() {
      const msgInput = document.getElementById("user-input");
      const msg = msgInput.value.trim();
      if (!msg) return;

      addMessage(msg, false); // User message
      msgInput.value = "";

      try {
        const res = await fetch("/api/chat", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ message: msg }),
        });
        const data = await res.json();
        addMessage(data.reply || "Sorry, I didn't get that.", true); // Bot reply
      } catch (error) {
        addMessage("âš ï¸ Failed to connect. Please try again later.", true);
      }
    }

    document.getElementById("send-btn").addEventListener("click", sendMessage);
    document.getElementById("user-input").addEventListener("keypress", (e) => {
      if (e.key === "Enter") sendMessage();
    });
  </script>
</body>
</html>
